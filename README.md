# Azure SIEM (Sentinel) and SOC-Based Strategies for a Secure Cloud Honeynet: Optimising and Hardening Cloud Security Posture.
---

![image](https://github.com/user-attachments/assets/8d5782db-c49d-496d-9281-819e1b634b44)


## Table of Contents
- [Project Description](#project-description)
- [Architecture of the Mini Azure Honeynet ](#architecture-of-the-mini-azure-honeynet)
- ["Before" Metrics: Initial Insecure Configuration](#before-metrics-initial-insecure-configuration)
- ["After" Metrics: Hardened Secure Configuration](#after-metrics-hardened-secure-configuration)
- [Measured Metrics](#measured-metrics)
- [Key Steps in the Project](#key-steps-in-the-project)
- [Project Goal](#project-goal)
- [Results](#results)
  - [Attack Maps Before Hardening](#attack-maps-before-hardening)
  - [Metrics Before Hardening](#metrics-before-hardening)
  - [Metrics After Hardening / Security Controls](#metrics-after-hardening--security-controls)
  - [Metrics Comparison Before and After Hardening](#metrics-comparison-before-and-after-hardening)
- [Key Observations](#key-observations)
- [Conclusion](#conclusion)


---
## Project Description
This project involves setting up a cloud-based honeynet within Azure and utilising Microsoft Sentinel for Security Information and Event Management (SIEM). The project also focuses on integrating Security Operations Centre (SOC) strategies. The honeynet environment was designed and deployed to attract and monitor malicious activities over a 24-hour period. Subsequently, various security controls were applied to enhance and harden the security posture, and the environment was monitored for another 24 hours. Metrics were measured to showcase the security posture of the honeynet environment before and after hardening.

---
## Architecture of the Mini Azure Honeynet
The Azure honeynet architecture consists of the following components:

1. **Virtual Network (VNet):** A virtual network that provides an isolated environment for the honeynet.
2. **Network Security Group (NSG):** Used to control inbound and outbound traffic to the resources within the VNet.
3. **Virtual Machines:** Three virtual machines (two Windows and one Linux) deployed to simulate vulnerable systems that attackers might target.
4. **Log Analytics Workspace:** A centralised logging and monitoring solution to collect, query, and analyse log data from various resources.
5. **Azure Key Vault:** Securely stores sensitive information like keys, secrets, and certificates used in the environment.
6. **Azure Storage Account:** Provides storage for log files, analytics data, and other relevant information generated by the honeynet.
7. **Microsoft Sentinel:** A SIEM solution used to monitor, detect, and respond to threats by analysing data from the Log Analytics Workspace.

---
## "Before" Metrics: Initial Insecure Configuration

- The virtual machines had both their Network Security Groups (NSGs) and built-in firewalls wide open, allowing unrestricted inbound and outbound traffic.
- All other resources, including the Azure Key Vault and Azure Storage Account, were deployed with public endpoints, making them visible and accessible from the internet.
- No Private Endpoints were utilised, resulting in a highly exposed environment vulnerable to potential threats.

---
## "After" Metrics: Hardened Secure Configuration

- **Network Security Groups (NSGs):** Hardened by blocking all inbound and outbound traffic except for connections from a specific admin workstation, reducing the attack surface.
- **Built-in Firewalls and Private Endpoints:** All other resources, such as Azure Key Vault and Azure Storage Account, were protected by their built-in firewalls, and public endpoints were replaced with Private Endpoints to ensure secure, private access.

---
## Measured Metrics

To evaluate the security posture of the honeynet environment, the following metrics were measured:

1. **SecurityEvent (Windows Event Logs):** Tracks security-related events on the Windows virtual machines, providing insights into potential threats or malicious activities.
2. **Syslog (Linux Event Logs):** Gathers security and operational logs from the Linux virtual machine, offering a view of any suspicious activities.
3. **SecurityAlert (Log Analytics Alerts Triggered):** Represents the number of alerts triggered by Log Analytics, highlighting potential threats detected within the environment.
4. **Security Incident (Incidents Created by Sentinel):** Indicates the number of incidents automatically created by Microsoft Sentinel based on the alerts, which are then analysed for further action.
5. **Azure Network Analytics_CL (Malicious Flows Allowed into the Honeynet):** Captures the number of malicious network flows that were allowed into the honeynet, offering insights into the types of attacks attempted.

---
## Key Steps in the Project

1. **Deploying a Cloud Honeynet:** Setting up a network of decoy systems in Azure to simulate a vulnerable environment and attract potential attackers.
2. **Ingesting Logs:** Collecting and analysing logs from both Windows and Linux systems, as well as network traffic, and feeding them into Azure Log Analytics for comprehensive monitoring.
3. **Utilising Microsoft Sentinel:** Using Sentinel to build attack maps, trigger alerts, and create incidents based on the collected log data to detect and respond to threats.
4. **Measuring and Improving Security Posture:** Comparing security metrics before and after implementing security controls to evaluate their effectiveness in improving the overall security posture.

---
## Project Goal

The goal of this project is to demonstrate how SIEM tools like Microsoft Sentinel and SOC strategies can optimise cloud security by effectively detecting and responding to potential threats. By analysing the "before" and "after" metrics, the project showcases the impact of hardening security controls on the overall cloud security posture.

---
# Results

---
## Attack Maps Before Hardening

### Microsoft-SQL Authentication Fail

![image](https://github.com/user-attachments/assets/8ca6932f-bab2-4796-a4ed-88e115815e9f)

---
### Linux-SSH Authentication Fail

![image](https://github.com/user-attachments/assets/200232ae-39e2-49d7-a4be-96fc59ce32cb)
---
### NSG Malicious allowed-in

![image](https://github.com/user-attachments/assets/fae6397d-131e-4b12-8f56-1154e7b81bcc)
---
### Windows RDP Authentication Fail

![image](https://github.com/user-attachments/assets/50044675-4baf-4745-9b0f-91a83ce3ac26)
---

## Metrics Before Hardening
---
### The table below shows the metrics measured within the insecure honeynet environment for 24 hours:

Start Time: `2024-07-19 12:37:19`  
Stop Time: `2024-07-20 12:37:19`

| Metric                   | Count  |
| ------------------------ | ------ |
| SecurityEvent            | 21,240 |
| Syslog                   | 6,340  |
| SecurityAlert            | 1      |
| SecurityIncident         | 570    |
| AzureNetworkAnalytics_CL | 103    |

---
## Metrics After Hardening / Security Controls
---
### The table below shows the metrics measured within the hardened secure honeynet environment for 24 hours:

Start Time: `2024-07-26 10:34`  
Stop Time: `2024-07-27 10:34`

| Metric                   | Count |
| ------------------------ | ----- |
| SecurityEvent            | 9,117 |
| Syslog                   | 15    |
| SecurityAlert            | 0     |
| SecurityIncident         | 11    |
| AzureNetworkAnalytics_CL | 0     |

---
## Metrics Comparison Before and After Hardening

| Metric                         | Before Hardening (24h) | After Hardening (24h) | Change (%)             |
|--------------------------------|------------------------|-----------------------|------------------------|
| SecurityEvent (Windows)        | 21,240 Events          | 9,117 Events          | 57.08% Improvement     |
| Syslog (Linux)                 | 6,340 Events           | 15 Events             | 99.76% Improvement     |
| SecurityAlert                  | 1 Alerts               | 0 Alerts              | 100.00% Improvement    |
| SecurityIncident               | 570 Incidents          | 11 Incidents          | 98.07% Improvement     |
| AzureNetworkAnalytics_CL       | 103 Malicious Flows    | 0 Malicious Flows     | 100.00% Improvement    |

---
## Key Observations

- **Decrease in Security Events:** Both Windows and Linux environments show a significant reduction in security events after hardening. This indicates that the applied security controls were effective in reducing attack surfaces.
- **Reduction in Alerts and Incidents:** A decrease in the number of triggered alerts and incidents suggests a more secure environment with fewer potential threats.
- **Malicious Network Traffic:** A substantial drop in malicious network flows (AzureNetworkAnalytics_CL) indicates improved network security posture, likely due to NSGs, firewalls, and other traffic-filtering measures.

---  
## Conclusion
The project successfully demonstrates how implementing security controls can effectively reduce the attack surface and improve the overall security posture of an environment in Azure. Showcasing these metrics before and after applying security controls provides a compelling case for using Azure's native security tools like Microsoft Sentinel and Log Analytics for monitoring, threat detection, and incident response.

